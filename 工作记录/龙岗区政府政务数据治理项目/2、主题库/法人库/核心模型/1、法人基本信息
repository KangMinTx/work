
ä¸€ã€æ³•äººåŸºæœ¬ä¿¡æ¯(dwd_jbxx_frjcxx)
ä¸€ã€å…ˆåˆ›å»ºä¸€å¼ é›†åˆè¡¨ï¼ˆtable_allï¼‰ï¼Œå…¶å–æ•°é€»è¾‘ï¼šä»¥std_qfzggj_aic_base(åŒºå‘å±•æ”¹é©å±€_ç™»è®°å¤‡æ¡ˆä¿¡æ¯)ä¸ºä¸»è¡¨ï¼Œ
å·¦å…³è”std_schzljgw_sszt_jbxx110497 (å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯)ï¼ˆåˆ†åˆ«ä»¥æœºæž„åç§°ã€ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ã€æ³¨å†Œå·åŠç»„ç»‡æœºæž„ä»£ç ä¸ºå…³è”æ¡ä»¶ï¼‰ï¼Œè¡¥å…¨ä¿¡æ¯
ç»„æˆä¸€å¼ B1è¡¨ï¼Œå†å·¦å…³è”std_qzfw_view_qy_jcxxï¼ˆåŒºæ”¿æ³•å§”-ä¼ä¸šåŸºç¡€ä¿¡æ¯ï¼‰è¡¨ï¼ŒæŒ‰ç…§ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ã€æœºæž„åç§°åˆ†ç»„ï¼Œè®°å½•åˆ›å»ºæ—¶é—´æŽ’åºï¼Œå–ä¸€æ¡è®°å½•ï¼Œå¾—åˆ°é›†åˆè¡¨ï¼ˆtable_allï¼‰

äºŒã€ä»¥é›†åˆè¡¨ï¼ˆtable_allï¼‰ä¸ºä¸»è¡¨ï¼Œä¸”å­˜åœ¨ï¼ˆexistsï¼‰std_qfzggj_aic_jgbaseï¼ˆå·¥å•†ç™»è®°ç›‘ç®¡ä¿¡æ¯è¡¨ï¼‰çš„ä¼ä¸šï¼Œå¹¶ä¸”å±žäºŽåœ¨é¾™å²—ç™»è®°çš„ä¼ä¸šï¼ˆjgorgcode='4500'ï¼‰
å·¦å…³è”std_qfzggj_aic_base(åŒºå‘å±•æ”¹é©å±€_ç™»è®°å¤‡æ¡ˆä¿¡æ¯)ï¼Œä¸”å­˜åœ¨ï¼ˆexistsï¼‰std_qfzggj_aic_jgbaseï¼ˆå·¥å•†ç™»è®°ç›‘ç®¡ä¿¡æ¯è¡¨ï¼‰çš„ä¼ä¸šï¼Œå¹¶ä¸”å±žäºŽåœ¨é¾™å²—ç™»è®°çš„ä¼ä¸šï¼ˆjgorgcode='4500'ï¼‰
å·¦å…³è”std_schzljgw_sszt_jbxx110497 (å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯)
å·¦å…³è”std_qzfw_view_qy_jcxx (åŒºæ”¿æ³•å§”-ä¼ä¸šåŸºç¡€ä¿¡æ¯)
å·¦å…³è”std_qzfw_view_ywk_sszt_hc (åŒºæ”¿æ³•å§”å—æ•°æ®ä¼ä¸šæˆ¿å±‹ä¿¡æ¯)
å·¦å…³è”std_qzfw_view_ywk_tydz (åŒºæ”¿æ³•å§”_ç»Ÿä¸€åœ°å€è¡¨)ï¼Œè¡¥å……ç›¸å…³å­—æ®µä¿¡æ¯
æŒ‰ç…§ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ã€æœºæž„åç§°åˆ†ç»„ï¼Œè®°å½•åˆ›å»ºæ—¶é—´æŽ’åºï¼Œå–ä¸€æ¡è®°å½•ï¼Œå¾—åˆ°æ³•äººåŸºæœ¬ä¿¡æ¯

----------------------------------------------------------------------------------------æ³•äººåŸºæœ¬ä¿¡æ¯-------------------------------------------------------------------------------------
--_********************************************************_
--author: He
--create time: 2020-11-19 10:58:47
--table_name : dwd_jbxx_frjcxx (åŸºæœ¬ä¿¡æ¯_æ³•äººåŸºç¡€ä¿¡æ¯)
--use_tables : std_qfzggj_aic_base (åŒºå‘å±•æ”¹é©å±€_ç™»è®°å¤‡æ¡ˆä¿¡æ¯)
--			   std_schzljgw_sszt_jbxx110497 (å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯)
--			   std_qzfw_view_qy_jcxx (åŒºæ”¿æ³•å§”-ä¼ä¸šåŸºç¡€ä¿¡æ¯)
--			   std_qzfw_view_ywk_sszt_hc (åŒºæ”¿æ³•å§”å—æ•°æ®ä¼ä¸šæˆ¿å±‹ä¿¡æ¯)
--			   std_qzfw_view_ywk_tydz (åŒºæ”¿æ³•å§”_ç»Ÿä¸€åœ°å€è¡¨)
--å–æ•°é€»è¾‘:ç”¨AIC_BASEä½œä¸ºä¸»è¡¨ ,é€šè¿‡[ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ,ä¼ä¸šåç§°,æ³¨å†Œå·,ç»„ç»‡æœºæž„ä»£ç ](4è€…æ»¡è¶³ä¸€æ¡å³å¯) å·¦å…³è” SSZT_JBXX110497 
--         å·¦å…³è” lgqzfw.view_rk_jcxx å·¦å…³è” lgqzfw.view_ywk_sszt_hc è¡¥å……å…¶ä»–ç›¸å…³ä¿¡æ¯
--1123:ç­›é€‰tyshxydm é•¿åº¦å¤§äºŽ1
--1203:ä¸åŠ ä¼ä¸šçŠ¶æ€é™åˆ¶
--1212:è¡¥å……ç»è¥åœ°å€æ¥æº ä»Ž  std_schzljgw_sszt_jbxx110497 (å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯) ä¸­å–
--1217:è¡¥å……å¸‚ç›‘ä¼ä¸šçŠ¶æ€ å­—å…¸å‚è€ƒ aic_base çš„ä¼ä¸šçŠ¶æ€å­—å…¸
--0118:æ–°å¢ž4ä¸ªå­—æ®µï¼šæœºæž„ç±»åž‹åç§°ï¼ˆlgl_organization_nameï¼‰ï¼Œè¡Œä¸šé—¨ç±»ä»£ç ï¼ˆhymldmï¼‰ï¼Œå¸ç§ä»£ç ï¼ˆbzdmï¼‰ï¼Œè¡Œä¸šåç§°ï¼ˆhymcï¼‰,è¡Œä¸šåç§°æš‚ç©º
--æ’å…¥è¯­å¥åœ¨ä¸´æ—¶è¡¨ä¸‹æ–¹ðŸ‘‡
--20210524 æ–°å¢žé€»è¾‘ç™»è®°å¤‡æ¡ˆä¿¡æ¯ä¸Žå·¥å•†ç™»è®°ç›‘ç®¡ä¿¡æ¯è¡¨é€šè¿‡ä¸»ä½“èº«ä»½ä»£ç ï¼ˆentidï¼‰å…³è”ï¼Œ
--ç™»è®°å¤‡æ¡ˆä¿¡æ¯ä¸­é™åˆ¶ä¸»ä½“çŠ¶æ€ï¼ˆENTSTATUSï¼‰å­—æ®µä¸ºâ€å­˜ç»­ï¼ˆåœ¨è¥ã€å¼€ä¸šã€åœ¨å†Œï¼‰â€ï¼Œå·¥å•†ç™»è®°ç›‘ç®¡ä¿¡æ¯è¡¨ä¸­é™åˆ¶ç›‘ç®¡æœºå…³ç¼–ç ä¸º"4500",å¢žåŠ æ³¨å†Œèµ„æœ¬å­—æ®µ,è¿˜æœ‰ä¹‹å‰ç™»è®°å¤‡æ¡ˆä¿¡æ¯å’Œå•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯å…±åŒçš„ä¸šåŠ¡å­—æ®µ,ä¹‹å‰æ˜¯å–å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯,çŽ°åœ¨ä»¥ç™»è®°å¤‡æ¡ˆä¿¡æ¯ä¸ºä¸»
--_********************************************************_
 
 
--------------------------------------------------------------------å…ˆåˆ›å»ºä¸€å¼ é›†åˆè¡¨ï¼ˆtable_allï¼‰------------------------------------------------------------
with table_all AS (
SELECT  *
FROM 
(
	SELECT  b1.a_lgl_id  --æ³•äººå”¯ä¸€æ ‡è¯†
	       ,b1.b_lgl_id --æ³•äººå”¯ä¸€æ ‡è¯†
	       ,b2.lgl_id AS c_lgl_id --æ³•äººå”¯ä¸€æ ‡è¯†
	       ,nvl(b1.lgl_name,b2.lgl_name) lgl_name --æœºæž„åç§° 
	       ,nvl(b1.tyshxydm,b2.tyshxydm) tyshxydm   --ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
	       ,nvl(b1.zch,b2.zch) zch --æ³¨å†Œå·
	       ,nvl(b1.zzjgdm,b2.zzjgdm) zzjgdm --ç»„ç»‡æœºæž„ä»£ç 
	       ,nvl(b1.GLDM_CREATE_TIME,b2.GLDM_CREATE_TIME) GLDM_CREATE_TIME --è®°å½•åˆ›å»ºæ—¶é—´
	       ,nvl(b1.lyb,b2.lyb) lyb --æ¥æºè¡¨
	       ,row_number() over(partition by nvl(b1.lgl_name,b2.lgl_name) ,nvl(b1.tyshxydm,b2.tyshxydm) ORDER BY nvl(b1.GLDM_CREATE_TIME,b2.GLDM_CREATE_TIME) desc ) rank
---------------------------------æŒ‰ç…§æœºæž„åç§°ã€ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç åˆ†ç»„ï¼Œè®°å½•åˆ›å»ºæ—¶é—´æŽ’åºï¼Œå–æœ€æ–°ä¸€æ¡è®°å½•------------------------------------------------------------------------	
--b1.a_lgl_idï¼Œä¸ºstd_qfzggj_aic_baseï¼šrecordid
--b1.b_lgl_id  ä¸ºstd_schzljgw_sszt_jbxx110497ï¼šrecordid
--b2.lgl_id  AS c_lgl_id ä¸ºstd_qzfw_view_qy_jcxxï¼šfrid
--lgl_name ä¸ºstd_qfzggj_aic_baseï¼šentnameã€std_schzljgw_sszt_jbxx110497ï¼šlgl_nameã€std_qzfw_view_qy_jcxxï¼šqymc
--tyshxydm ä¸ºstd_qfzggj_aic_baseï¼šentsccodeã€std_schzljgw_sszt_jbxx110497ï¼štyshxydmã€std_qzfw_view_qy_jcxxï¼štyshxydm
--zch  ä¸ºstd_qfzggj_aic_baseï¼šentregnoã€std_schzljgw_sszt_jbxx110497ï¼šzchã€std_qzfw_view_qy_jcxxï¼šzch
--zzjgdm  ä¸ºstd_qfzggj_aic_baseï¼šentorgcodeã€std_schzljgw_sszt_jbxx110497ï¼šzzjgdmã€std_qzfw_view_qy_jcxxï¼šzzjgdm
--GLDM_CREATE_TIME ä¸ºstd_qfzggj_aic_baseï¼šGLDM_CREATE_TIMEã€std_qzfw_view_qy_jcxxï¼štimeflag
   
	FROM 
	(
		SELECT  * 
				,row_number() over(partition by tyshxydm,lgl_name ORDER BY CASE WHEN lyb='std_qfzggj_aic_base' THEN '1' WHEN lyb='std_schzljgw_sszt_jbxx110497' THEN '2' end asc,GLDM_CREATE_TIME) rn
------------------------------------------------æŒ‰ç…§ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ã€æœºæž„åç§°åˆ†ç»„ï¼Œè®°å½•åˆ›å»ºæ—¶é—´æŽ’åºï¼Œå–ä¸€æ¡è®°å½•------------------------------------------------------------------------
		FROM 
		(
			SELECT  t1.lgl_id                                              AS a_lgl_id --æ³•äººå”¯ä¸€æ ‡è¯†
			       ,nvl(nvl(nvl(t5.lgl_id,t4.lgl_id),t3.lgl_id),t2.lgl_id) AS b_lgl_id --æ³•äººå”¯ä¸€æ ‡è¯†
			       ,nvl(nvl(nvl(nvl(t1.lgl_name,t5.lgl_name),t4.lgl_name),t3.lgl_name),t2.lgl_name) lgl_name  --æœºæž„åç§° 
			       ,nvl(nvl(nvl(nvl(t1.tyshxydm,t5.tyshxydm),t4.tyshxydm),t2.tyshxydm),t3.tyshxydm) tyshxydm  --ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
			       ,nvl(nvl(nvl(nvl(t1.zch,t5.zch),t3.zch),t2.zch),t4.zch) zch --æ³¨å†Œå·
			       ,nvl(nvl(nvl(nvl(t1.zzjgdm,t4.zzjgdm),t3.zzjgdm),t2.zzjgdm),t5.zzjgdm) zzjgdm --ç»„ç»‡æœºæž„ä»£ç 
			       ,t1.GLDM_CREATE_TIME --è®°å½•åˆ›å»ºæ—¶é—´
			       ,nvl(t2.lyb,t1.lyb) lyb --æ¥æºè¡¨
------------------------æ³•äººå”¯ä¸€æ ‡è¯†_b_lgl_idï¼Œå–std_schzljgw_sszt_jbxx110497è¡¨ä¸­çš„recordidï¼ˆt5,t4,t3,t2ï¼‰ï¼Œæ³•äººå”¯ä¸€æ ‡è¯†_a_lgl_id,å…ˆå–std_qfzggj_aic_baseä¸­çš„recordid
--æœºæž„åç§°_lgl_name,å…ˆå–std_qfzggj_aic_baseä¸­çš„entnameï¼Œç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç _tyshxydm,å…ˆå–std_qfzggj_aic_baseä¸­çš„entsccode,å†å–std_schzljgw_sszt_jbxx110497ä¸­çš„tyshxydm
--å†å–std_schzljgw_sszt_jbxx110497è¡¨ä¸­çš„lgl_nameï¼Œæ³¨å†Œå·_zchå…ˆå–std_qfzggj_aic_baseä¸­çš„entregnoï¼Œå†å–std_schzljgw_sszt_jbxx110497è¡¨ä¸­çš„zchã€‚
--ç»„ç»‡æœºæž„ä»£ç _zzjgdm,å…ˆå–std_qfzggj_aic_baseä¸­çš„entorgcodeï¼Œå†å–std_schzljgw_sszt_jbxx110497è¡¨ä¸­çš„zzjgdmï¼Œè®°å½•åˆ›å»ºæ—¶é—´_GLDM_CREATE_TIMEï¼Œå–std_qfzggj_aic_baseä¸­çš„GLDM_CREATE_TIME
			FROM 
			(
				SELECT  entid                 AS lgl_id 
				       ,entname               AS lgl_name 
				       ,entname               AS lgl_short_name 
				       ,null                  AS lgl_english_name 
				       ,entsccode             AS tyshxydm 
				       ,entregno              AS zch 
				       ,entorgcode            AS zzjgdm 
				       ,datatime              AS GLDM_CREATE_TIME 
				       ,datatime              AS GLDM_UPDATE_TIME 
				       ,'std_qfzggj_aic_base' AS lyb
				FROM std_qfzggj_aic_base --åŒºå‘å±•æ”¹é©å±€_ç™»è®°å¤‡æ¡ˆä¿¡æ¯
				WHERE --entstatuscode='1' AND 
                dt=(SELECT  MAX(dt) FROM std_qfzggj_aic_base) 
			) t1
			LEFT JOIN 
			(
				SELECT  recordid                       AS LGL_ID 
				       ,qymc                           AS LGL_NAME 
				       ,tyshxydm                       AS tyshxydm 
				       ,zch                            AS zch 
				       ,zzjgdm                         AS zzjgdm 
				       ,timeflag                       AS GLDM_CREATE_TIME 
				       ,timeflag                       AS GLDM_UPDATE_TIME 
				       ,'std_schzljgw_sszt_jbxx110497' AS lyb
				FROM std_schzljgw_sszt_jbxx110497 --å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯
				WHERE --yyzt=1 AND 
                dt=(SELECT  MAX(dt) FROM std_schzljgw_sszt_jbxx110497) 
			) t2
			ON t1.LGL_NAME= t2.LGL_NAME
			LEFT JOIN 
			(
				SELECT  recordid                       AS LGL_ID 
				       ,qymc                           AS LGL_NAME 
				       ,tyshxydm                       AS tyshxydm 
				       ,zch                            AS zch 
				       ,zzjgdm                         AS zzjgdm 
				       ,timeflag                       AS GLDM_CREATE_TIME 
				       ,timeflag                       AS GLDM_UPDATE_TIME 
				       ,'std_schzljgw_sszt_jbxx110497' AS lyb
				FROM std_schzljgw_sszt_jbxx110497  --å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯
				WHERE --yyzt=1 AND 
                dt=(SELECT  MAX(dt) FROM std_schzljgw_sszt_jbxx110497) 
			) t3
			ON t1.tyshxydm=t3.tyshxydm
			LEFT JOIN 
			(
				SELECT  recordid                       AS LGL_ID 
				       ,qymc                           AS LGL_NAME 
				       ,tyshxydm                       AS tyshxydm 
				       ,zch                            AS zch 
				       ,zzjgdm                         AS zzjgdm 
				       ,timeflag                       AS GLDM_CREATE_TIME 
				       ,timeflag                       AS GLDM_UPDATE_TIME 
				       ,'std_schzljgw_sszt_jbxx110497' AS lyb
				FROM std_schzljgw_sszt_jbxx110497
				WHERE --yyzt=1 AND 
                dt=(SELECT  MAX(dt) FROM std_schzljgw_sszt_jbxx110497) --å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯
			) t4
			ON t1.zch = t4.zch
			LEFT JOIN 
			(
				SELECT  recordid                       AS LGL_ID 
				       ,qymc                           AS LGL_NAME 
				       ,tyshxydm                       AS tyshxydm 
				       ,zch                            AS zch 
				       ,zzjgdm                         AS zzjgdm 
				       ,timeflag                       AS GLDM_CREATE_TIME 
				       ,timeflag                       AS GLDM_UPDATE_TIME 
				       ,'std_schzljgw_sszt_jbxx110497' AS lyb
				FROM std_schzljgw_sszt_jbxx110497  --å¸‚åœºå’Œè´¨é‡ç›‘ç®¡å§”_å•†äº‹ä¸»ä½“åŸºæœ¬ä¿¡æ¯
				WHERE --yyzt=1 AND 
                dt=(SELECT  MAX(dt) FROM std_schzljgw_sszt_jbxx110497) 
			) t5
			ON t1.zzjgdm=t5.zzjgdm 
		) 
	) b1
	LEFT JOIN 
	(
		SELECT  frid                    AS LGL_ID 
		       ,qymc                    AS LGL_NAME 
		       ,qymc                    AS LGL_SHORT_NAME 
		       ,null                    AS LGL_ENGLISH_NAME 
		       ,tyshxydm                AS tyshxydm 
		       ,zch                     AS zch 
		       ,zzjgdm                  AS zzjgdm 
		       ,ssztlx                  AS LGL_ORGANIZATION_CODE 
		       ,fddbr                   AS LEGAL_PERSON_NAME 
		       ,frsfzh                  AS LEGAL_PERSON_CARD_NO 
		       ,jyfw                    AS BUSINESS_SCOPE 
		       ,clrq                    AS ESTABLISH_DATE 
		       ,jyqxq                   AS OPERATE_STATE_TIME 
		       ,jyqxz                   AS OPERATE_END_TIME 
		       ,timeflag                AS GLDM_CREATE_TIME 
		       ,timeflag                AS GLDM_UPDATE_TIME 
		       ,null                    AS LEGAL_PERSON_CARD_ID 
		       ,qyzt                    AS LGL_ENTSTAUS_NO 
		       ,hzrq                    AS LGL_AUTHDATE 
		       ,null                    AS LGL_PBUITEM 
		       ,djjgdh                  AS ADMIN_ORG_UNIT_NO 
		       ,fzjg                    AS ADMIN_ORG_UNIT 
		       ,null                    AS BUILDING_ID 
		       ,null                    AS HOUSE_ID 
		       ,bzdz                    AS ADDRESS_DETAIL 
		       ,zcdz                    AS ZCDZ 
		       ,zcdtydzbm               AS ZCDZ_CODE 
		       ,jydz                    AS JYDZ 
		       ,jydtydzbm               AS JYDZ_CODE 
		       ,bzdz                    AS BGDZ 
		       ,null                    AS BGDZ_CODE 
		       ,null                    AS SCDZ 
		       ,null                    AS SCDZ_CODE 
		       ,'std_qzfw_view_qy_jcxx' AS lyb
		FROM std_qzfw_view_qy_jcxx --åŒºæ”¿æ³•å§”-ä¼ä¸šåŸºç¡€ä¿¡æ¯
		WHERE dt=( 
		SELECT  MAX(dt)
		FROM std_qzfw_view_qy_jcxx) 
	) b2
	ON b1.tyshxydm=b2.tyshxydm
	WHERE b1.rn=1  
)
WHERE rank=1 ) 

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
insert overwrite table dwd_jbxx_frjcxx partition (dt='${DayBeforeStartTime}')
SELECT  LGL_ID --æ³•äººå”¯ä¸€æ ‡è¯† 
       ,LGL_NAME --æœºæž„åç§° 
       ,LGL_SHORT_NAME --æœºæž„ç®€ç§° 
       ,LGL_ENGLISH_NAME --æœºæž„è‹±æ–‡åç§° 
       ,tyshxydm --ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç  
       ,zch --ç™»è®°æˆ–æ³¨å†Œå· 
       ,zzjgdm --ç»„ç»‡æœºæž„ä»£ç  
       ,LGL_ORGANIZATION_CODE --æœºæž„ç±»åž‹ä»£ç  
       ,LGL_ORGANIZATION_NAME --æœºæž„ç±»åž‹
       ,LEGAL_PERSON_NAME --æ³•å®šä»£è¡¨äººæˆ–è´Ÿè´£äººå§“å 
       ,LEGAL_PERSON_CARD_NO --æ³•å®šä»£è¡¨äººæˆ–è´Ÿè´£äººè¯ä»¶å·ç  
       ,BUSINESS_SCOPE --ç»è¥èŒƒå›´ 
       ,ESTABLISH_DATE --æˆç«‹æ—¥æœŸ 
       ,OPERATE_STATE_TIME --ç»è¥æœŸé™è‡ª 
       ,OPERATE_END_TIME --ç»è¥æœŸé™è‡³
	   /*========1223æ–°å¢žå­—æ®µ====================*/
       ,hymldm  --è¡Œä¸šé—¨ç±»ä»£ç  ï¼ˆ0118æ–°å¢žï¼‰
       ,hyml -- è¡Œä¸šé—¨ç±»
       ,lsqymc -- éš¶å±žä¼ä¸šåç§°
       ,zczb   --æ³¨å†Œèµ„æœ¬
	   ,lsqyzch -- éš¶å±žä¼ä¸šæ³¨å†Œå·
	   ,sbsszb -- ç”³æŠ¥å®žæ”¶èµ„æœ¬
       ,bzdm    --å¸ç§ä»£ç 
	   ,bizhong -- å¸ç§
	   ,hydm -- è¡Œä¸šä»£ç 
       ,hymc -- è¡Œä¸šåç§°ï¼ˆæš‚æ—¶ç©ºï¼‰
	   ,jycs -- ç»è¥åœºæ‰€
	   ,njqk -- å¹´æ£€æƒ…å†µ
	   ,ndbgxx -- å¹´åº¦æŠ¥å‘Šä¿¡æ¯
	   ,ssztlx -- å•†äº‹ä¸»ä½“ç±»åž‹
	   ,yyzt -- ä¼ä¸šçŠ¶æ€
	   /*===================*/
       ,GLDM_CREATE_TIME --è®°å½•åˆ›å»ºæ—¶é—´ 
       ,GLDM_UPDATE_TIME --è®°å½•æ›´æ–°æ—¶é—´ 
       ,LEGAL_PERSON_CARD_ID --æ³•å®šä»£è¡¨äººæˆ–è´Ÿè´£äººè¯ä»¶ç±»åž‹ 
       ,LGL_ENTSTAUS_NO --æ³•äººä¸»ä½“çŠ¶æ€ 
       ,LGL_AUTHDATE --æ ¸å‡†æ—¥æœŸ 
       ,LGL_PBUITEM --è®¸å¯ç»è¥é¡¹ç›® 
       ,ADMIN_ORG_UNIT_NO --ç™»è®°ç®¡ç†éƒ¨é—¨ä»£ç  
       ,ADMIN_ORG_UNIT --ç™»è®°ç®¡ç†éƒ¨é—¨åç§° 
       ,BUILDING_ID --æ¥¼æ ‹ç¼–ç  
       ,HOUSE_ID --æˆ¿å±‹ç¼–ç  
       ,ADDRESS_DETAIL --è¯¦ç»†åœ°å€ 
       ,ZCDZ --æ³¨å†Œåœ°å€ 
       ,ZCDZ_CODE --æ³¨å†Œåœ°ç»Ÿä¸€åœ°å€ç¼–ç  
       ,JYDZ --ç»è¥åœ°å€ 
       ,JYDZ_CODE --ç»è¥åœ°ç»Ÿä¸€åœ°å€ç¼–ç  
       ,BGDZ --åŠžå…¬åœ°å€ 
       ,BGDZ_CODE --åŠžå…¬åœ°å€ä¸€åœ°å€ç¼–ç  
       ,SCDZ --ç”Ÿäº§åœ°å€ 
       ,SCDZ_CODE --ç”Ÿäº§åœ°å€ä¸€åœ°å€ç¼–ç  
       ,BRSJ --æ¬å…¥æ—¶é—´ 
       ,BLSJ --æ¬ç¦»æ—¶é—´ 
       ,ZBX --åæ ‡X 
       ,ZBY --åæ ‡Y 
       ,lyb --æ¥æºè¡¨ 
       ,lyjg --æ¥æºæœºæž„ 
       ,yxsj --è¿è¡Œæ—¶é—´
FROM 
(
	SELECT  t1.a_lgl_id                                            AS lgl_id   --ï¼ˆstd_qfzggj_aic_baseï¼šrecordidï¼‰
	       ,nvl(t2.lgl_name,t1.lgl_name)                           AS lgl_name --t2(std_qfzggj_aic_baseï¼šentname)ã€t1ï¼ˆstd_qfzggj_aic_baseï¼šentnameã€std_schzljgw_sszt_jbxx110497ï¼šlgl_nameã€std_qzfw_view_qy_jcxxï¼šqymcï¼‰
	       ,nvl(t2.lgl_name,t1.lgl_name)                           AS lgl_short_name --t2(std_qfzggj_aic_baseï¼šentname)ã€t1ï¼ˆstd_qfzggj_aic_baseï¼šentnameã€std_schzljgw_sszt_jbxx110497ï¼šlgl_nameã€std_qzfw_view_qy_jcxxï¼šqymcï¼‰
	       ,null                                                   AS lgl_english_name 
	       ,t1.tyshxydm                                            AS tyshxydm --t1ï¼ˆstd_qfzggj_aic_baseï¼šentsccodeã€std_schzljgw_sszt_jbxx110497ï¼štyshxydmã€std_qzfw_view_qy_jcxxï¼štyshxydmï¼‰
	       ,t1.zch                                                 AS zch --t1ï¼ˆstd_qfzggj_aic_baseï¼šentregnoã€std_schzljgw_sszt_jbxx110497ï¼šzchã€std_qzfw_view_qy_jcxxï¼šzchï¼‰
	       ,t1.zzjgdm                                              AS zzjgdm  --t1ï¼ˆstd_qfzggj_aic_baseï¼šentorgcodeã€std_schzljgw_sszt_jbxx110497ï¼šzzjgdmã€std_qzfw_view_qy_jcxxï¼šzzjgdmï¼‰
	       ,nvl(t2.LGL_ORGANIZATION_CODE,t3.LGL_ORGANIZATION_CODE) AS LGL_ORGANIZATION_CODE --t2(std_qfzggj_aic_base:enttypecode),t3(std_schzljgw_sszt_jbxx110497:ssztlx)
           ,nvl(t2.LGL_ORGANIZATION_NAME,t3.LGL_ORGANIZATION_NAME) as LGL_ORGANIZATION_NAME --t2(std_qfzggj_aic_base:enttype),t3(std_schzljgw_sszt_jbxx110497:ssztlx_name)
	       ,nvl(t2.LEGAL_PERSON_NAME,t3.LEGAL_PERSON_NAME)         AS LEGAL_PERSON_NAME --t3(std_schzljgw_sszt_jbxx110497:fddbr)
	       ,nvl(t2.LEGAL_PERSON_CARD_NO,t3.LEGAL_PERSON_CARD_NO)   AS LEGAL_PERSON_CARD_NO   --t3(std_schzljgw_sszt_jbxx110497:swzh)
	       ,nvl(t2.BUSINESS_SCOPE,t3.BUSINESS_SCOPE)               AS BUSINESS_SCOPE --t3(std_schzljgw_sszt_jbxx110497:clrq)
	       ,nvl(t2.ESTABLISH_DATE,t3.ESTABLISH_DATE)               AS ESTABLISH_DATE --t2(std_qfzggj_aic_base:estdate),t3(std_schzljgw_sszt_jbxx110497:jyfw)
	       ,substr(nvl(t2.OPERATE_STATE_TIME,t3.OPERATE_STATE_TIME),1,19)       AS OPERATE_STATE_TIME --t2(std_qfzggj_aic_base:opdatefrom),t3(std_schzljgw_sszt_jbxx110497:jyqxq)
	       ,substr(nvl(t2.OPERATE_END_TIME,t3.OPERATE_END_TIME),1,19)           AS OPERATE_END_TIME --t2(std_qfzggj_aic_base:opdatefrom),t3(std_schzljgw_sszt_jbxx110497:jyqxz)
		   /*==========1223æ–°å¢žå­—æ®µ===========*/
  		   ,t2.hymldm as hymldm --è¡Œä¸šé—¨ç±»ä»£ç   
           ,t2.hyml  as hyml -- è¡Œä¸šé—¨ç±»
		   ,t3.lsqymc as lsqymc -- éš¶å±žä¼ä¸šåç§°
		   ,t3.lsqyzch as lsqyzch -- éš¶å±žä¼ä¸šæ³¨å†Œå·
		   ,t2.zczb    as zczb   --æ³¨å†Œèµ„æœ¬
		   ,t3.sbsszb as sbsszb -- ç”³æŠ¥å®žæ”¶èµ„æœ¬
		   ,t2.bzdm as bzdm       --å¸ç§ä»£ç 
           ,t2.bizhong as bizhong -- å¸ç§
		   ,t2.hydm as hydm -- è¡Œä¸šä»£ç 
           ,t2.hymc as hymc -- è¡Œä¸šåç§° 
		   ,t3.jycs as jycs -- ç»è¥åœºæ‰€
		   ,t3.njqk as njqk -- å¹´æ£€æƒ…å†µ
		   ,t3.ndbgxx as ndbgxx -- å¹´åº¦æŠ¥å‘Šä¿¡æ¯
		   ,t2.ssztlx_name as ssztlx -- å•†äº‹ä¸»ä½“ç±»åž‹
		   ,t2.yyzt as yyzt -- ä¼ä¸šçŠ¶æ€
		   /*================================*/
	       ,nvl(t2.GLDM_CREATE_TIME,t3.GLDM_CREATE_TIME)           AS GLDM_CREATE_TIME --t2(std_qfzggj_aic_base:datatime),t3(std_schzljgw_sszt_jbxx110497:timeflag)
	       ,nvl(t2.GLDM_UPDATE_TIME,t3.GLDM_UPDATE_TIME)           AS GLDM_UPDATE_TIME --t2(std_qfzggj_aic_base:datatime),t3(std_schzljgw_sszt_jbxx110497:timeflag)
	       ,null                                                   AS LEGAL_PERSON_CARD_ID 
  		   /*1217è¡¥å……å¸‚ç›‘ä¼ä¸šçŠ¶æ€*/
	       ,nvl(t2.LGL_ENTSTAUS_NO,t3.LGL_ENTSTAUS_NO)			   AS LGL_ENTSTAUS_NO --t2(std_qfzggj_aic_base:entstatus),t3(std_schzljgw_sszt_jbxx110497:yyzt)
	       ,nvl(t2.LGL_AUTHDATE,t3.LGL_AUTHDATE)                   AS LGL_AUTHDATE --t2(std_qfzggj_aic_base:authdate),t3(std_schzljgw_sszt_jbxx110497:hzrq)
	       ,t2.LGL_PBUITEM                                         AS LGL_PBUITEM  --std_qfzggj_aic_base
	       ,nvl(t2.ADMIN_ORG_UNIT_NO,t3.ADMIN_ORG_UNIT_NO)             AS ADMIN_ORG_UNIT_NO --t2(std_qfzggj_aic_base:regorgcode)
	       ,nvl(t2.ADMIN_ORG_UNIT,t3.ADMIN_ORG_UNIT)                   AS ADMIN_ORG_UNIT --t2(std_qfzggj_aic_base:regorg)
	       ,nvl(nvl(t5.JZWTYDZBM,t6.jzwtydzbm),t7.jzwtydzbm)       AS BUILDING_ID --t3(std_schzljgw_sszt_jbxx110497:jzwtydzbm)
	       ,null                                                   AS HOUSE_ID 
	       ,nvl(t2.ADDRESS_DETAIL,t3.ADDRESS_DETAIL)               AS ADDRESS_DETAIL -- t2(std_qfzggj_aic_base:addr),t3(std_schzljgw_sszt_jbxx110497:jycs)
	       ,t4.ZCDZ                                                AS ZCDZ 
	       ,t4.ZCDZ_CODE                                           AS ZCDZ_CODE 
	       ,nvl(t3.ADDRESS_DETAIL,t4.JYDZ)                         AS JYDZ 
	       ,t4.JYDZ_CODE                                           AS JYDZ_CODE 
	       ,null                                                   AS BGDZ 
	       ,null                                                   AS BGDZ_CODE 
	       ,null                                                   AS SCDZ 
	       ,null                                                   AS SCDZ_CODE 
	       ,t4.BRSJ                                                AS BRSJ 
	       ,t4.BLSJ                                                AS BLSJ 
	       ,t8.lon                                                 AS ZBX 
	       ,t8.lat                                                 AS ZBY 
	       ,nvl(nvl(nvl(t1.lyb,t2.lyb),t3.lyb),t4.lyb)             AS lyb 
	       ,nvl(nvl(t2.lyjg,t3.lyjg),t4.lyjg)                      AS lyjg 
	       ,CURRENT_TIMESTAMP                                      AS yxsj 
	       ,row_number() over(partition by t1.tyshxydm ORDER BY t1.zch,t1.zzjgdm,nvl(t2.LGL_ORGANIZATION_CODE,t3.LGL_ORGANIZATION_CODE),nvl(t2.BUSINESS_SCOPE,t3.BUSINESS_SCOPE),nvl(t2.OPERATE_STATE_TIME,t3.OPERATE_STATE_TIME),nvl(t2.GLDM_CREATE_TIME,t3.GLDM_CREATE_TIME) desc ) rn
	FROM (select * from table_all a where exists(
										select 1 from
											std_qfzggj_aic_jgbase b where b.dt=(select max(dt) from std_qfzggj_aic_jgbase) and a.a_lgl_id=b.entid and b.jgorgcode='4500'
											)   
										)t1
	LEFT JOIN 
	(
		SELECT  entid                 AS lgl_id 
		       ,entname               AS lgl_name 
		       ,entname               AS lgl_short_name 
		       ,null                  AS lgl_english_name 
		       ,entsccode             AS tyshxydm 
		       ,entregno              AS zch 
		       ,entorgcode            AS zzjgdm 
		       ,enttypecode           AS LGL_ORGANIZATION_CODE 
               ,enttype          	  AS LGL_ORGANIZATION_NAME
		       ,null                  AS LEGAL_PERSON_NAME 
		       ,null                  AS LEGAL_PERSON_CARD_NO 
		       ,null                  AS BUSINESS_SCOPE 
		       ,estdate               AS ESTABLISH_DATE 
		       ,opdatefrom            AS OPERATE_STATE_TIME 
		       ,opdateto              AS OPERATE_END_TIME 
			   ,bigindustrycode  as hymldm -- è¡Œä¸šé—¨ç±»ä»£ç 
               ,bigindustry as hyml --è¡Œä¸šé—¨ç±»åç§°
			   ,null as lsqymc -- éš¶å±žä¼ä¸šåç§°
			   ,null as lsqyzch -- éš¶å±žä¼ä¸šæ³¨å†Œå·
			   , case when currency='ç¾Žå…ƒ' then round(regcap*6.4354,4)
when currency='æ¬§å…ƒ' then round(regcap*7.8434,4)
when currency='æŒªå¨å…‹æœ—' then round(regcap*0.76871,4)
when currency='äººæ°‘å¸' then round(regcap,4)
when currency='æ–°åŠ å¡å…ƒ' then round(regcap*4.8305,4)
when currency='é¦™æ¸¯å…ƒ' then round(regcap*0.82828,4)
when currency='æ³°å›½é“¢' then round(regcap*0.20505,4)
when currency='æ—¥å…ƒ' then round(regcap*0.059180,4)
when currency='è²å¾‹å®¾æ¯”ç´¢' then round(regcap*0.13427,4)
when currency='è‹±é•‘' then round(regcap*9.1011,4)
when currency='ç‘žå£«æ³•éƒŽ' then round(regcap*7.1636,4)
when currency='ç‘žå…¸å…‹æœ—' then round(regcap*0.77295,4)
when currency='åŠ å…ƒ' then round(regcap*5.3279,4) else round(regcap,4) end as zczb -- æ³¨å†Œèµ„æœ¬
			   ,currency as bizhong -- å¸ç§
               ,currencycode as bzdm --å¸ç§ä»£ç 
			   ,smallindustrycode as hydm -- è¡Œä¸šä»£ç 
      		   ,smallindustry as hymc --è¡Œä¸šåç§°
			   ,null as jycs -- ç»è¥åœºæ‰€
               ,null as njqk -- å¹´æ£€æƒ…å†µ
               ,null as ndbgxx -- å¹´åº¦æŠ¥å‘Šä¿¡æ¯
               ,enttypecode as ssztlx -- å•†äº‹ä¸»ä½“ç±»åž‹
               ,enttype as ssztlx_name --å•†äº‹ä¸»ä½“ç±»åž‹åç§°
			   ,entstatus yyzt-- ä¼ä¸šçŠ¶æ€
		       ,datatime              AS GLDM_CREATE_TIME 
		       ,datatime              AS GLDM_UPDATE_TIME 
		       ,null                  AS LEGAL_PERSON_CARD_ID 
		       ,entstatus             AS LGL_ENTSTAUS_NO 
		       ,authdate              AS LGL_AUTHDATE 
		       ,pbuitem               AS LGL_PBUITEM 
		       ,regorgcode            AS ADMIN_ORG_UNIT_NO 
		       ,regorg                AS ADMIN_ORG_UNIT 
		       ,null                  AS BUILDING_ID 
		       ,null                  AS BOUSE_ID 
		       ,addr                  AS ADDRESS_DETAIL 
		       ,'std_qfzggj_aic_base' AS lyb 
		       ,lyjg                  AS lyjg
		FROM std_qfzggj_aic_base a
		WHERE --entstatuscode='1'  AND 
        dt=(SELECT  MAX(dt) FROM std_qfzggj_aic_base) and
      exists(     select 1 from std_qfzggj_aic_jgbase b where b.dt=(select max(dt) from std_qfzggj_aic_jgbase) and a.entid=b.entid and b.jgorgcode='4500'
											)   
	) t2
	ON t1.a_lgl_id=t2.lgl_id
	LEFT JOIN 
	(
		SELECT  recordid                       AS LGL_ID 
		       ,qymc                           AS LGL_NAME 
		       ,qymc                           AS LGL_SHORT_NAME 
		       ,NULL                           AS LGL_ENGLISH_NAME 
		       ,tyshxydm                       AS tyshxydm 
		       ,zch                            AS zch 
		       ,zzjgdm                         AS zzjgdm 
		       ,ssztlx                         AS LGL_ORGANIZATION_CODE 
               ,ssztlx_name                    AS LGL_ORGANIZATION_NAME
		       ,fddbr                          AS LEGAL_PERSON_NAME 
		       ,swzh                           AS LEGAL_PERSON_CARD_NO 
		       ,jyfw                           AS BUSINESS_SCOPE 
		       ,clrq                           AS ESTABLISH_DATE 
		       ,jyqxq                          AS OPERATE_STATE_TIME 
		       ,jyqxz                          AS OPERATE_END_TIME 
      		   /*===1223===æ–°å¢žå­—æ®µ*/
			   ,lsqymc as lsqymc -- éš¶å±žä¼ä¸šåç§°
			   ,lsqyzch as lsqyzch -- éš¶å±žä¼ä¸šæ³¨å†Œå·
       		   ,sbsszb as sbsszb -- ç”³æŠ¥å®žæ”¶èµ„æœ¬
			   ,jycs as jycs -- ç»è¥åœºæ‰€
               ,njqk as njqk -- å¹´æ£€æƒ…å†µ
               ,ndbgxx as ndbgxx -- å¹´åº¦æŠ¥å‘Šä¿¡æ¯
               ,ssztlx as ssztlx -- å•†äº‹ä¸»ä½“ç±»åž‹
               ,ssztlx_name as ssztlx_name --å•†äº‹ä¸»ä½“ç±»åž‹åç§°
			   ,case when yyzt='1' then 'å­˜ç»­ï¼ˆåœ¨è¥ã€å¼€ä¸šã€åœ¨å†Œï¼‰'
  				     when yyzt='11' then 'åœä¸š'
    				 when yyzt='2' then 'åŠé”€'
      				 when yyzt='3' then ''
        			 when yyzt='4' then 'æ³¨é”€'
          			 when yyzt='6' then 'è¿å‡º'
            		 when yyzt='7' then 'ä¸ªä½“æš‚æ—¶åŠé”€'
              		 when yyzt='8' then 'æ’¤é”€ç™»è®°'
                else null end as yyzt -- ä¼ä¸šçŠ¶æ€
      		   /*==========*/
		       ,timeflag                       AS GLDM_CREATE_TIME 
		       ,timeflag                       AS GLDM_UPDATE_TIME 
		       ,null                           AS LEGAL_PERSON_CARD_ID 
		       /*1217è¡¥å……è¥ä¸šçŠ¶æ€-ä¼ä¸šçŠ¶æ€,æ•°æ®å…ƒå‚è€ƒaic_baseçš„å­—å…¸*/
      		   ,case when yyzt='1' then 'å­˜ç»­ï¼ˆåœ¨è¥ã€å¼€ä¸šã€åœ¨å†Œï¼‰'
  				     when yyzt='11' then 'åœä¸š'
    				 when yyzt='2' then 'åŠé”€'
      				 when yyzt='3' then ''
        			 when yyzt='4' then 'æ³¨é”€'
          			 when yyzt='6' then 'è¿å‡º'
            		 when yyzt='7' then 'ä¸ªä½“æš‚æ—¶åŠé”€'
              		 when yyzt='8' then 'æ’¤é”€ç™»è®°'
                else null end                 AS LGL_ENTSTAUS_NO 
		       ,hzrq                           AS LGL_AUTHDATE 
		       ,null                           AS LGL_PBUITEM 
		       ,null                           AS ADMIN_ORG_UNIT_NO 
		       ,null                           AS ADMIN_ORG_UNIT 
		       ,null                           AS BUILDING_ID 
		       ,fwbm                           AS HOUSE_ID 
		       ,jycs                           AS ADDRESS_DETAIL 
		       ,'std_schzljgw_sszt_jbxx110497' AS lyb 
		       ,lyjg                           AS lyjg
		FROM std_schzljgw_sszt_jbxx110497
		WHERE --yyzt=1 AND 
        dt=(SELECT  MAX(dt) FROM std_schzljgw_sszt_jbxx110497)
	) t3
	ON t1.b_lgl_id=t3.LGL_ID
	LEFT JOIN 
	(
		SELECT  frid                    AS LGL_ID 
		       ,qymc                    AS LGL_NAME 
		       ,qymc                    AS LGL_SHORT_NAME 
		       ,null                    AS LGL_ENGLISH_NAME 
		       ,tyshxydm                AS tyshxydm 
		       ,zch                     AS zch 
		       ,zzjgdm                  AS zzjgdm 
		       ,ssztlx                  AS LGL_ORGANIZATION_CODE 
		       ,fddbr                   AS LEGAL_PERSON_NAME 
		       ,frsfzh                  AS LEGAL_PERSON_CARD_NO 
		       ,jyfw                    AS BUSINESS_SCOPE 
		       ,clrq                    AS ESTABLISH_DATE 
		       ,jyqxq                   AS OPERATE_STATE_TIME 
		       ,jyqxz                   AS OPERATE_END_TIME 
		       ,timeflag                AS GLDM_CREATE_TIME 
		       ,timeflag                AS GLDM_UPDATE_TIME 
		       ,null                    AS LEGAL_PERSON_CARD_ID 
		       ,qyzt                    AS LGL_ENTSTAUS_NO 
		       ,hzrq                    AS LGL_AUTHDATE 
		       ,null                    AS LGL_PBUITEM 
		       ,djjgdh                  AS ADMIN_ORG_UNIT_NO 
		       ,fzjg                    AS ADMIN_ORG_UNIT 
		       ,null                    AS BUILDING_ID 
		       ,null                    AS HOUSE_ID 
		       ,bzdz                    AS ADDRESS_DETAIL 
		       ,zcdz                    AS ZCDZ 
		       ,zcdtydzbm               AS ZCDZ_CODE 
		       ,jydz                    AS JYDZ 
		       ,jydtydzbm               AS JYDZ_CODE 
		       ,bzdz                    AS BGDZ 
		       ,null                    AS BGDZ_CODE 
		       ,null                    AS SCDZ 
		       ,null                    AS SCDZ_CODE 
		       ,'std_qzfw_view_qy_jcxx' AS lyb 
		       ,sxsj                    AS BRSJ 
		       ,xwsj                    AS BLSJ 
		       ,lyjg                    AS lyjg
		FROM std_qzfw_view_qy_jcxx
		WHERE dt=( 
		SELECT  MAX(dt)
		FROM std_qzfw_view_qy_jcxx)
	) t4
	ON t1.c_lgl_id=t4.LGL_ID
	LEFT JOIN 
	(
		SELECT  tyshxydm,qymc,zch,jzwtydzbm 
		FROM std_qzfw_view_ywk_sszt_hc
		WHERE dt=( 
		SELECT  MAX(dt)
		FROM std_qzfw_view_ywk_sszt_hc )
	) t5
	ON t1.tyshxydm=t5.tyshxydm
  left join 
  (
		SELECT  tyshxydm,qymc,zch,jzwtydzbm 
		FROM std_qzfw_view_ywk_sszt_hc
		WHERE dt=( 
		SELECT  MAX(dt)
		FROM std_qzfw_view_ywk_sszt_hc )
	) t6
	ON t1.lgl_name=t6.qymc
  left join 
    (
		SELECT  tyshxydm,qymc,zch,jzwtydzbm 
		FROM std_qzfw_view_ywk_sszt_hc
		WHERE dt=( 
		SELECT  MAX(dt)
		FROM std_qzfw_view_ywk_sszt_hc )
	) t7
	ON t1.zch=t7.zch
	LEFT JOIN 
	(
		SELECT  *
		FROM std_qzfw_view_ywk_tydz
		WHERE dt=( 
		SELECT  MAX(dt)
		FROM std_qzfw_view_ywk_tydz)
	) t8
	ON t5.JZWTYDZBM=t8.SSLDBM
)
WHERE rn =1  and length(tyshxydm)>1

